syntax = "proto3";

package qubic.v2.archive.pb;

option go_package = "github.com/qubic/archive-query-service/api";
import "messages.proto";
import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "protoc_gen_openapiv2/options/annotations.proto";

option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "Qubic Query API"
    description: "API for querying archived Qubic data."
    version: "1.0.0"
  }
  host: "rpc.qubic.org"
  base_path: "/query/v1"
  schemes: HTTPS
  consumes: "application/json"
  produces: "application/json"
  external_docs: {
    description: "Github";
    url: "https://github.com/qubic/archive-query-service";
  }
};

// Qubic Query API
service ArchiveQueryService {

  // Get a single transaction by its hash.
  rpc GetTransactionByHash(GetTransactionByHashRequest) returns (GetTransactionByHashResponse) {
    option (google.api.http) = {
      post: "/getTransactionByHash"
      body: "*"
      response_body: "transaction"
    };
  }

  // Get the transactions that are in included in one tick.
  rpc GetTransactionsForTick(GetTransactionsForTickRequest) returns (GetTransactionsForTickResponse) {
    option (google.api.http) = {
      post: "/getTransactionsForTick"
      body: "*"
      response_body: "transactions"
    };
  }

  // Get the transactions for one identity sorted by tick number descending.
  rpc GetTransactionsForIdentity(GetTransactionsForIdentityRequest) returns (GetTransactionsForIdentityResponse) {
    option (google.api.http) = {
      post: "/getTransactionsForIdentity"
      body: "*"
    };
  }

  // Get the tick data for one tick.
  rpc GetTickData(GetTickDataRequest) returns (GetTickDataResponse) {
    option (google.api.http) = {
      post: "/getTickData"
      body: "*"
    };
  }

  // Get the list(s) of computors for one epoch.
  rpc GetComputorsListsForEpoch(GetComputorListsForEpochRequest) returns (GetComputorListsForEpochResponse){
    option(google.api.http) = {
      post: "/getComputorListsForEpoch"
      body: "*"
    };
  }

  // Get the last processed tick that is available in the archive.
  rpc GetLastProcessedTick(google.protobuf.Empty) returns (GetLastProcessedTickResponse) {
    option (google.api.http) = {
      get: "/getLastProcessedTick"
    };
  }

  // Get the tick intervals that are available in the archive.
  rpc GetProcessedTickIntervals(google.protobuf.Empty) returns (GetProcessedTickIntervalsResponse) {
    option (google.api.http) = {
      get: "/getProcessedTickIntervals"
      response_body: "processed_tick_intervals"
    };
  }

  // Health check. This is for internal use only and can change any time.
  rpc GetHealth(google.protobuf.Empty) returns (HealthResponse) {
    option (google.api.http) = {
      get: "/health"
    };
  }

}
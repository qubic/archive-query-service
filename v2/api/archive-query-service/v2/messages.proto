syntax = "proto3";

package qubic.v2.archive.pb;
option go_package = "github.com/qubic/archive-query-service/api";
import "protoc_gen_openapiv2/options/annotations.proto";

message LastProcessedTick {
    uint32 tick_number = 1;
}

message NextAvailableTick {
    uint32 next_tick_number = 1;
}

// Transaction
message Transaction {
  string hash = 1;
  uint64 amount = 2;
  string source = 3;
  string destination = 4;
  uint32 tick_number = 5;
  uint64 timestamp = 6;
  uint32 input_type = 7;
  uint32 input_size = 8;
  string input_data = 9;
  string signature = 10;
  // Money flew is an additional information provided by some nodes with the tx status addon patch.
  bool money_flew = 11;
}

// TickData
message TickData {
  uint32 tick_number = 1;
  uint32 epoch = 2;
  uint32 computor_index = 3;
  uint64 timestamp = 4;
  string var_struct = 5;
  string time_lock = 6;
  repeated string transaction_hashes = 7;
  repeated int64 contract_fees = 8;
  string signature = 9;
}

// ProcessedTickInterval
message ProcessedTickInterval {
  // the epoch the interval is in.
  uint32 epoch = 1;
  // the initial processed tick of the interval.
  uint32 first_tick = 2;
  // the last processed tick of the interval.
  uint32 last_tick = 3;
}

// Pagination
//
// The number of maximum results (offset + size) is limited to 10000.
message Pagination {
  // The offset specifies the starting point of the returned data. Defaults to zero.
  uint32 offset = 1;
  // The size specifies how many results should be returned. Defaults to 10.
  uint32 size = 2;
}

// GetTransactionByHashRequest
message GetTransactionByHashRequest {
  // Hash of the transaction.
  string hash = 1;
}

// GetTransactionByHashResponse
message GetTransactionByHashResponse {
  // the transaction for the requested hash.
  Transaction transaction = 1;
}

// GetTransactionsForTickRequest
message GetTransactionsForTickRequest {
  // the tick number to get the transactions for.
  uint32 tick_number = 1;
}

// GetTransactionsForTickResponse
message GetTransactionsForTickResponse {
  // the transactions for the requested tick number.
  repeated Transaction transactions = 1;
}

// Range
message Range {
  oneof lower_bound {
    // greater than.
    string gt = 1;
    // greater than or equal.
    string gte = 2;
  }
  oneof upper_bound {
    // less than.
    string lt = 3;
    // less than or equal.
    string lte = 4;
  }
}

// GetTransactionsForIdentityRequest

message GetTransactionsForIdentityRequest {

  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: '\"{\\"identity\\": \\"AFZPUAIYVPNUYGJRQVLUKOPPVLHAZQTGLYAAUUNBXFTVTAMSBKQBLEIEPCVJ\\",\\"filters\\": { \\"destination\\": \\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFXIB\\",\\"inputType\\": \\"0\\"}, \\"ranges\\": { \\"amount\\": { \\"gte\\": \\"1000000000\\" } }, \\"pagination\\": { \\"offset\\": 0, \\"size\\": 10 } } \"'
  };

  // The identity to get the transactions for. Incoming and outgoing transactions are queried by default.
  string identity = 1;
  // Filters restrict the results by single values.
  map<string, string> filters = 2;
  // Ranges restrict the results by a maximum and minimum value.
  map<string, Range> ranges = 3;
  // Optional paging information.
  Pagination pagination = 4;

}

// Hits
//
// Provides information about the number of results.
message Hits {
  // the total number of hits available in the archive. Capped at 10000.
  uint32 total = 1;
  // starting offset of the hits that were returned.
  uint32 from = 2;
  // number of returned hits.
  uint32 size = 3;
}

// GetTransactionsForIdentityResponse
message GetTransactionsForIdentityResponse {
  // the response is valid for this tick number.
  uint32 valid_for_tick = 1;
  // information about the returned results.
  Hits hits = 2;
  // list of transactions that matched the search criteria.
  repeated Transaction transactions = 3;
}

// GetTickDataRequest
message GetTickDataRequest {
  // the number of tick the tick data is requested for.
  uint32 tick_number = 1;
}

// GetTickDataResponse
message GetTickDataResponse {
  // the tick data of the requested tick.
  TickData tick_data = 1;
}

// GetProcessedTickIntervalsResponse
message GetProcessedTickIntervalsResponse {
  // a list of tick intervals that were processed.
  repeated ProcessedTickInterval processed_tick_intervals = 1;
}

// GetLastProcessedTickResponse
message GetLastProcessedTickResponse {
  // the last processed tick that is available in the archive.
  uint32 tick_number = 1;
  // the epoch the last processed tick is in.
  uint32 epoch = 2;
  // the initial tick of the current tick interval.
  uint32 interval_initial_tick = 3;
}

// GetComputorListsForEpochRequest
message GetComputorListsForEpochRequest {
  // the epoch number to get the computor lists for.
  uint32 epoch = 1;
}

// ComputorList
message ComputorList {
  // epoch number.
  uint32 epoch = 1;
  // tick number when the list was received by the archive after it was published.
  uint32 tick_number = 2;
  // list of computor identities (signed by arbitrator).
  repeated string identities = 3;
  // signature of the arbitrator.
  string signature = 4;
}

// GetComputorListsForEpochResponse
message GetComputorListsForEpochResponse {
  // the lists of computors that voted in this epoch.
  repeated ComputorList computors_lists = 1;
}

// HealthResponse
message HealthResponse {
  // health status information.
  string status = 1;
}